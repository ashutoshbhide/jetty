<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Jetty 7 Architecture</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><meta name="keywords" content="jetty, servlet-api, cometd, http, spdy, eclipse, maven, java, software"><link rel="home" href="index.html" title="Jetty : The Definitive Reference"><link rel="up" href="architecture.html" title="Chapter&nbsp;12.&nbsp;Architecture"><link rel="prev" href="architecture.html" title="Chapter&nbsp;12.&nbsp;Architecture"><link rel="next" href="advanced-jetty-start.html" title="Chapter&nbsp;13.&nbsp;Starting Jetty"><link xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" rel="shortcut icon" href="images/favicon.ico"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><center xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-logo.svg" width="80"></a></center><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Jetty 7 Architecture</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="architecture.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;12.&nbsp;Architecture</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="advanced-jetty-start.html">Next</a></td></tr></table><hr></div><div xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" style="background-color: #DFF2FD; text-align: left; font-size:80%; font-family: arial, sans; border:thin dotted blue; padding: 4px; "><span style="font-variant: small-caps; font-weight: bold"><a href="http://www.webtide.com/support.jsp" style="text-decoration:none">Contact the core Jetty developers at
          <span style="color:#fd360b"> www.webtide.com</span></a></span><br><span style="font-style:oblique;font-size: 80%">
 private support for your internal/customer projects ... custom extensions and distributions ... versioned snapshots for indefinite support ...
 scalability guidance for your apps and Ajax/Comet projects ... development services from 1 day to full product delivery
    </span></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="basic-architecture"></a>Jetty 7 Architecture</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="basic-architecture.html#d0e6251">View from 20,000 feet</a></span></dt><dt><span class="section"><a href="basic-architecture.html#d0e6287">Patterns</a></span></dt><dt><span class="section"><a href="basic-architecture.html#d0e6303">Connectors</a></span></dt><dt><span class="section"><a href="basic-architecture.html#d0e6336">Handlers</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6251"></a>View from 20,000 feet</h3></div></div></div><p>The Jetty Server is the plumbing between a collection of Connectors that accept HTTP connections, and a
    collection of Handlers that service requests from the connections and produce responses, with the work being done
    by threads taken from a thread pool.</p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td align="center"><img src="images/jetty-high-level-architecture.png" align="middle" width="540"></td></tr></table></div><p>While the jetty request/responses are derived from the Servlet API, the full features of the servlet API are
    only available if the appropriate handlers are configured. For example, the session API on the request is inactive
    unless the request has been passed to a Session Handler. The concept of a Servlet itself is implemented by a
    Servlet Handler. If servlets are not required, there is very little overhead in the use of the servlet
    request/response APIs. Thus you can build a Jetty server using only connectors and handlers, without using
    Servlets.</p><p>The job of configuring jetty is the job of building a network of connectors and handlers and providing their
    individual configurations. As Jetty components are simply Plain Old Java Objects (POJOs), you can accomplish this
    assembly and configuration of components by a variety of techniques:</p><p>deeper <a class="xref" href="">???</a></p><p>deepest <a class="link" href="">this is custom</a></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>In code. See the examples in the Jetty 7 Latest Source XRef.</p></li><li class="listitem"><p>With Jetty XML - dependency injection style XML format.</p></li><li class="listitem"><p>With your dependency injection framework of choice: Spring or XBean.</p></li><li class="listitem"><p>Using Jetty WebApp and Context Deployers.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6287"></a>Patterns</h3></div></div></div><p>The implementation of Jetty follows some fairly standard patterns. Most abstract concepts such as Connector,
    Handler and Buffer are captured by interfaces. Generic handling for those interfaces is then provided in an
    Abstract implementation such as AbstractConnector, AbstractHandler and AbstractBuffer.</p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td align="center"><img src="images/basic-architecture-patterns.png" align="middle" width="540"></td></tr></table></div><p>The JSR77 inspired life cycle of most jetty components is represented by LifeCycle interface and the
    AbstractLifeCycle implementation used as the base of many Jetty components.</p><p>Jetty provides its own IO Buffering abstract over String, byte arrays and NIO buffers. This allows for
    greater portability of Jetty as well as hiding some of the complexity of the NIO layer and its advanced
    features.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6303"></a>Connectors</h3></div></div></div><p>This diagram is a little out of date, as a Connection interface has been extracted out of HttpConnector to
    allow support for the AJP protocol.</p><p>The connectors represent the protocol handlers that accept connections, parse requests and generate
    responses. The different types of connectors available are based on the protocols, scheduling model and IO APIs
    used:</p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td align="center"><img src="images/basic-architecture-connectors.png" align="middle" width="540"></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>SocketConnector - for few busy connections or when NIO is not available</p></li><li class="listitem"><p>BlockingChannelConnector - for few busy connections when NIO is available</p></li><li class="listitem"><p>SelectChannelConnector - for many mostly idle connections or asynchronous handling of Ajax
        requests</p></li><li class="listitem"><p>SslSocketConnector - SSL without NIO</p></li><li class="listitem"><p>SslSelectChannelConnector - SSL with non blocking NIO support</p></li><li class="listitem"><p>AJPConnector AJP protocol support for connections from apache mod_jk or mod_proxy_ajp</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6336"></a>Handlers</h3></div></div></div><p>The Handler is the component that deals with received requests. The core API of a handler is the handle
    method:</p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td align="center"><img src="images/basic-architecture-handlers.png" align="middle" width="540"></td></tr></table></div><div class="informalexample"><pre class="programlisting">

<strong class="hl-keyword">public</strong> <strong class="hl-keyword">void</strong> handle(String target, Request baseRequest, HttpServletRequest request, HttpServletResponse response) <strong class="hl-keyword">throws</strong> IOException, ServletException

      </pre></div><p>Parameters:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>target&#8218;&Auml;&igrave;The target of the request, either a URI or a name.</p></li><li class="listitem"><p>baseRequest&#8218;&Auml;&igrave;The original unwrapped request object.</p></li><li class="listitem"><p>request&#8218;&Auml;&igrave;The request either as the Request object or a wrapper of that request. You can
        use the HttpConnection.getCurrentConnection() method to access the Request object if required.</p></li><li class="listitem"><p>response&#8218;&Auml;&igrave;The response as the Response object or a wrapper of that request. You can use
        the HttpConnection.getCurrentConnection() method to access the Response object if required.</p></li></ul></div><p>An implementation of this method can handle the request, pass the request onto another handler (or servlet)
    or it might modify and/or wrap the request and then pass it on. This gives three styles of Handler:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Coordinating Handlers - Handlers that route requests to other handlers (eg HandlerCollection,
        ContextHandlerCollection) 
        <span style="color: red">&lt;listitem&gt;<p>Filtering Handlers - Handlers that augment a request and pass it on to other handlers (eg.
          HandlerWrapper, ContextHandler, SessionHandler) 
          <span style="color: red">&lt;listitem&gt;<p>Generating Handlers - Handlers that produce content (eg ResourceHandler and ServletHandler) 
            </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6378"></a>Nested Handlers and Handlers Called Sequentially</h2></div></div></div><p>You can combine handlers to handle different aspects of a request by nesting them, calling them in
              sequence, or by combining the two models.</p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td align="center"><img src="images/basic-architecture-nested-handlers.png" align="middle" width="540"></td></tr></table></div><p>Handlers called in sequence perform actions that do not depend on the next invocation, nor on the
              handler order. They handle a request and generate the response without interacting with other handlers.
              The main class for this model is Handler Collection.</p><p>Nested handlers are called according to a before/invokeNext/after pattern. The main class for
              nested handlers is Handler Wrapper. Nested handlers are much more common than those called in
              sequence.</p><p>See also <a class="xref" href="">???</a>.</p></div><p>
            </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6399"></a>Servlet Handler</h2></div></div></div><p>The ServletHandler is a Handler that generates content by passing the request to any configured
              Filters and then to a Servlet mapped by a URI pattern.</p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td align="center"><img src="images/basic-architecture-servlet-handler.png" align="middle" width="540"></td></tr></table></div><p>A ServletHandler is normally deployed within the scope of a servlet Context, which is a
              ContextHandler that provides convenience methods for mapping URIs to servlets.</p><p>Filters and Servlets can also use a RequestDispatcher to reroute a request to another context or
              another servlet in the current context.</p></div><p>
            </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6416"></a>Context</h2></div></div></div><p>Contexts are handlers that group other handlers below a particular URI context path or a virtual
              host. Typcially a context can have :</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>A context path that defines which requests are handled by the context (eg /myapp )</p></li><li class="listitem"><p>A resource base for static content (a docroot)</p></li><li class="listitem"><p>A class loader to obtain classes specific to the context (typically
                  docroot/WEB-INF/classes)</p></li><li class="listitem"><p>Virtual host names</p></li></ul></div><p>Contexts implementations include:</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>ContextHandler</p></li><li class="listitem"><p>Servlet Context</p></li><li class="listitem"><p>Web Application Context</p></li></ul></div><p>A web application context combines handlers for security, session and servlets in a single unit
              that can be configured with a web.xml descriptor.</p></div><p>
            </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6449"></a>Web Application</h2></div></div></div><p>A Web App Context is a derivation of the servlet Context that supports the standardized layout of a
              web application and configuration of session, security, listeners, filter, servlets and JSP via a web.xml
              descriptor normally found in the WEB-INF directory of a webapplication.</p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td align="center"><img src="images/basic-architecture-web-application.png" align="middle" width="540"></td></tr></table></div><p>Essentially the WebAppContext is a convenience class that assists the construction and
              configuration of other handlers to achieve a standard web application configuration.</p><p>Configuration is actually done by pluggable implementations of the Configuration class and the
              prime among these is WebXmlConfiguration.</p></div>&lt;/listitem&gt;</span></p>&lt;/listitem&gt;</span></p></li></ul></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="architecture.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="architecture.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="advanced-jetty-start.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;12.&nbsp;Architecture&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;13.&nbsp;Starting Jetty</td></tr></table></div><div xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" style="background-color: #DFF2FD; text-align: left; font-size:80%; font-family: arial, sans; border:thin dotted blue; padding: 4px; "><span style="font-style:oblique;font-size: 80%">
See an error or something missing?<br></span><span style="font-variant: small-caps; font-weight: bold"><a href="http://github.com/jetty-project/jetty-documentation" style="text-decoration:none">Contribute to this documentation at 
          <span style="color:#fd360b"> Github!</span></a></span><br></div></body></html>